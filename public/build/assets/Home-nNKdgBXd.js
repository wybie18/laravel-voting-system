import{r,j as e,a as J,W as K,Y as Q,b as U}from"./app-BcsY7O2q.js";import{I as Z}from"./InputLabel-CyGcDeY6.js";import{M as _}from"./Modal-DxtK4YOM.js";import{P as v}from"./PrimaryButton-C8FhZBRR.js";import{S as D}from"./SecondaryButton-fjEJyUDk.js";import{T as ee}from"./TextInput-3pcFdHwf.js";import{A as se}from"./ApplicationLogo-hxMkxlo9.js";import{N as ae,R as te}from"./ResponsiveNavLink-ClbaQ8b7.js";import{I as re,_ as g}from"./index-CVxfNNzs.js";import"./transition-B-1_29jg.js";function le({header:n,links:d,children:m}){const[i,o]=r.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsxs("nav",{className:"bg-white border-b border-gray-100 sticky top-0",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"shrink-0 flex items-center",children:e.jsx(J,{href:"/",children:e.jsx(se,{className:"block h-9 w-auto fill-current text-gray-800"})})}),e.jsx("div",{className:"hidden space-x-8 md:-my-px md:ms-10 md:flex",children:d.map(t=>e.jsx(ae,{href:route("home",{election:t.id}),active:route().current("home",{election:t.id}),children:t.name},t.id))})]}),e.jsx("div",{className:"-me-2 flex items-center md:hidden",children:e.jsx("button",{onClick:()=>o(t=>!t),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out",children:e.jsxs("svg",{className:"h-6 w-6",stroke:"currentColor",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("path",{className:i?"hidden":"inline-flex",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"}),e.jsx("path",{className:i?"inline-flex":"hidden",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})]})})})]})}),e.jsx("div",{className:(i?"block":"hidden")+" md:hidden",children:e.jsx("div",{className:"pt-2 pb-3 space-y-1",children:d.map(t=>e.jsx(te,{href:route("home",{election:t.id}),active:route().current("home",{election:t.id}),children:t.name},t.id))})})]}),n&&e.jsx("header",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:n})}),e.jsx(re,{position:"top-right",reverseOrder:!1}),e.jsx("main",{children:m})]})}function pe({positions:n,candidates:d,elections:m,currectElectionId:i,success:o}){const[t,N]=r.useState(!1),[B,y]=r.useState(!1),[F,I]=r.useState(""),[O,R]=r.useState(""),[w,b]=r.useState({}),[x,S]=r.useState(null),[C,h]=r.useState({}),u=r.useRef(null),{data:k,setData:f,post:A,processing:H,errors:ne,reset:T}=K({election_id:i,email:"",votes:[]}),W=s=>{I(s.name),R(s.description),N(!0)},E=()=>{N(!1)},X=s=>{s.preventDefault();const a=new FormData(u.current),l={};let M=!0;const P={},L=[];n.forEach(c=>{const p=a.get(c.name);p?(l[c.name]=d.data.find(z=>z.id.toString()===p),L.push({position_name:c.name,candidate_id:p})):(M=!1,P[c.name]="Selection required")}),h(P),f("votes",L),M&&x?(b(l),y(!0)):x||g.error("Please enter a valid SFXC email")},j=()=>{y(!1)},Y=s=>{if(s){let a=0;for(const l in s)s.hasOwnProperty(l)&&setTimeout(()=>{g.error(s[l])},a),a+=150}},V=()=>{A(route("vote.store"),{preserveScroll:!0,onSuccess:()=>{T(),u.current.reset(),b({}),h({}),S(null),j()},onError:s=>Y(s)})},q=async s=>{try{const a=await U.get(`/api/check-email?email=${s}`);f("email",s),S(a.data.exists)}catch(a){console.error("Error checking email",a)}},G=s=>{h(a=>{const l={...a};return delete l[s],l})},$=s=>{s&&g.success(s)};return r.useEffect(()=>{$(o)},[o]),e.jsxs(le,{header:e.jsx("h1",{children:"Home"}),links:m,children:[e.jsx(Q,{children:e.jsx("title",{children:"Home"})}),e.jsx("div",{className:"py-12",children:n.length===0?e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6 text-gray-900",children:e.jsx("p",{children:"No active election found."})})})}):e.jsxs("form",{id:"election-form",className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",onSubmit:X,ref:u,children:[e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsxs(Z,{htmlFor:"voter_email",children:["Your SFXC Email ",e.jsx("span",{className:"text-red-900",children:"*"})]}),e.jsx(ee,{type:"email",id:"voter_email",name:"email",className:"mt-4",value:k.email,onChange:s=>f("email",s.target.value),onBlur:s=>q(s.target.value)}),x===!1&&e.jsx("p",{className:"text-red-500",children:"Email is not registered."}),e.jsx("input",{type:"hidden",name:"election_id",value:i})]})}),n.map(s=>e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-700",children:s.name}),e.jsx("hr",{}),e.jsx("p",{className:"mt-2 text-base text-gray-500",children:"Select only one candidate"}),d.data.filter(a=>a.position.name===s.name).map(a=>e.jsx("div",{className:"mt-4 md:px-10 w-full border-t-2 border-b-2 py-2",children:e.jsxs("div",{className:"flex items-center justify-between overflow-hidden",children:[e.jsxs("label",{className:"md:space-x-10",children:[e.jsx("input",{type:"radio",name:s.name,value:a.id,className:"border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500 m-2",onChange:()=>G(s.name)}),e.jsx("img",{src:a.image_url,alt:"profile",className:"w-12 h-12 md:w-16 md:h-16 object-cover rounded-full inline"}),e.jsx("span",{className:"ml-2 text-lg text-gray-700",children:a.name})]}),e.jsx(v,{type:"button",className:"me-1",onClick:()=>W(a),children:"Platform"})]})},a.id)),C[s.name]&&e.jsx("p",{className:"text-red-500",children:C[s.name]})]})},s.name)),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(v,{type:"submit",className:"me-1",children:"Preview"})})]})}),e.jsx(_,{show:t,onClose:E,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:[F," - Platform"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 indent-8",children:O}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(D,{onClick:E,children:"Close"})})]})}),e.jsx(_,{show:B,onClose:j,children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Preview your selections"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700",children:"Your SFXC Email"}),e.jsx("p",{className:"text-base text-gray-600",children:k.email})]}),Object.keys(w).map(s=>{var a;return e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700",children:s}),e.jsx("p",{className:"text-base text-gray-600",children:(a=w[s])==null?void 0:a.name})]},s)}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(D,{onClick:j,className:"mr-2",children:"Go Back"}),e.jsx(v,{onClick:V,disabled:H,children:"Confirm"})]})]})})]})}export{pe as default};
